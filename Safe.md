# 第9章 数据库安全方案设计

数据库安全是多层次的防御体系，涵盖用户认证、权限控制、数据加密、审计日志等多个方面。

## 9.1 用户认证和权限管理

### 9.1.1 数据库用户角色规划

根据系统运维与业务需求，划分以下五类数据库用户角色：

| 用户角色 | 建议用户名 | 描述 | 核心权限/职责 |
| :--- | :--- | :--- | :--- |
| **应用用户** | APP_USER | 生产环境应用程序连接数据库使用的账户 | 拥有业务数据的增删改查权限，可执行业务存储过程。 |
| **报表用户** | REPORT_USER | 用于BI报表、数据分析的只读账户 | 仅拥有业务数据的查询权限，严格限制对敏感字段的访问。 |
| **管理员** | DBA_ADMIN | 数据库管理员(DBA)维护使用 | 拥有DBA最高权限，负责系统配置、用户管理等。 |
| **备份用户** | BACKUP_USER | 自动化备份脚本使用的账户 | 拥有导出数据库、读取所有数据的权限，用于灾备。 |
| **审计用户** | AUDIT_USER | 安全审计人员使用 | 查看数据库审计日志，监控异常访问行为。 |

### 9.1.2 权限分配矩阵

针对不同数据对象，实施最小权限原则（Principle of Least Privilege）：

| 数据对象类别 | 具体对象示例 | APP_USER (应用) | REPORT_USER (报表) | 安全备注 |
| :--- | :--- | :--- | :--- | :--- |
| **核心业务表** | RECIPES, RATINGS, COMMENTS | 读写 (Select, Insert, Update, Delete) | 只读 (Select) | 公开业务数据，报表可分析。 |
| **用户敏感表** | USERS | 读写 | **受限只读** | 报表用户通过列级安全策略，**不可见**密码、手机号等隐私字段。 |
| **私有数据表** | SHOPPING_LISTS, MEAL_PLANS | 读写 | **无权限** | 个人私有数据，仅应用端可操作，报表端无需访问。 |
| **基础字典表** | INGREDIENTS, UNITS, TAGS | 只读 | 只读 | 基础元数据，通常由后台管理，应用端仅引用。 |
| **业务逻辑** | publish_recipe, rate_recipe (存储过程) | 执行 (Execute) | 无权限 | 封装复杂业务逻辑，防止直接SQL注入。 |

## 9.2 数据加密策略

为防止数据泄露，在存储和传输层面实施以下加密措施：

| 加密层面 | 策略名称 | 保护对象 | 实现方案描述 |
| :--- | :--- | :--- | :--- |
| **身份认证** | 密码哈希存储 | 用户登录密码 | 严禁明文存储。使用 **SHA-256** 或更高级别的哈希算法（加盐）在写入数据库前进行单向加密。 |
| **静态数据** | 透明数据加密 (TDE) | 敏感表 (USERS, API_TOKENS) | 启用数据库引擎的 **TDE (Transparent Data Encryption)** 功能，对存储在磁盘上的数据文件进行加密，防止物理介质失窃导致的数据泄露。 |
| **敏感字段** | 字段级加密 | API令牌、支付凭证 | 对极高敏感度字段（如 `token_value`），使用 **AES-256** 算法进行加密存储，仅在需要时解密。 |
| **传输数据** | SSL/TLS 加密 | 客户端与数据库连接 | 强制数据库监听器仅接受 **SSL/TLS** 加密连接，防止网络抓包窃取数据。 |