# 第8章 视图设计方案

视图是一种虚拟表，基于一个或多个实际表的查询结果。本项目的视图主要用于简化前端查询逻辑、封装复杂关联以及提供数据报表。

**设计原则**：
1.  **只读限制**：所有视图均应定义为 `WITH READ ONLY`，仅用于数据读取，禁止通过视图进行 DML 操作。
2.  **性能优化**：视图底层查询应利用已建立的索引，避免全表扫描。

## 8.1 视图列表归纳

| 类别 | 视图名称 | 描述/用途 | 关键数据源 |
| :--- | :--- | :--- | :--- |
| **用户相关** | **USER_OVERVIEW**<br>(用户概览) | **个人资料页展示**。<br>聚合用户的基本信息、食谱数、粉丝数、关注数及平均评分。 | Users, Recipes, Followers, Ratings |
| | **ACTIVE_USERS**<br>(活跃用户) | **运营分析**。<br>筛选过去7天内有发布、评分或评论行为的用户。 | Users, Activity Logs |
| | **USER_CONTRIBUTION_SCORE**<br>(贡献评分) | **排行榜计算**。<br>基于食谱、粉丝、互动量加权计算用户的社区贡献分。 | Users, Ratings, Comments |
| **食谱相关** | **RECIPE_DETAIL**<br>(食谱详情) | **详情页展示**。<br>封装食谱基本信息、作者信息及营养成分，屏蔽已删除数据。 | Recipes, Users, Nutrition |
| | **POPULAR_RECIPES**<br>(热门食谱) | **推荐算法**。<br>基于评分(50%)、评价数(30%)、浏览量(20%)计算热度分。 | Recipes, Ratings |
| | **RECIPE_WITH_INGREDIENTS**<br>(食材清单) | **详情页展示**。<br>将食谱与食材、单位、过敏原表进行关联展平。 | Recipes, Ingredients, Units |
| | **RECIPE_WITH_STEPS**<br>(烹饪步骤) | **详情页展示**。<br>按顺序提取烹饪步骤，支持步骤导航（上一布/下一步）。 | Recipes, Cooking_Steps |
| **社交互动** | **USER_NETWORK**<br>(社交网络) | **个人中心**。<br>统计用户的社交圈数据（关注/粉丝/收藏/评论数）。 | Users, Followers, Saved_Recipes |
| | **USER_FEED**<br>(用户动态) | **首页Feed流**。<br>聚合用户关注对象的最新动态（发布、评分、评论）。 | Followers, Activity_Log |
| | **TOP_CONTRIBUTORS**<br>(顶级贡献者) | **社区发现**。<br>按综合指标排名的优质创作者列表。 | Users, Ratings |
| **健康与安全** | **INGREDIENT_HEALTH_PROFILE**<br>(食材档案) | **健康分析**。<br>展示食材的分类、过敏原信息及在食谱中的使用频率。 | Ingredients, Allergens |
| | **SAFE_RECIPES_FOR_USER**<br>(安全食谱) | **个性化推荐**。<br>自动过滤掉当前用户过敏原的食谱列表。 | Recipes, User_Allergies |
| **规划与购物** | **MEAL_PLAN_SUMMARY**<br>(计划摘要) | **膳食管理**。<br>统计膳食计划的天数、食谱数及覆盖时段。 | Meal_Plans, Meal_Plan_Entries |
| | **CONSOLIDATED_SHOPPING_LIST**<br>(购物清单) | **工具功能**。<br>合并膳食计划中所有食谱的食材，自动汇总同类食材数量。 | Meal_Plans, Ingredients |
| **分析报表** | **RECIPE_QUALITY_METRICS**<br>(质量指标) | **后台审核**。<br>多维度评估食谱质量（图片、步骤完整度、互动率）。 | Recipes, Comments, Steps |
| | **MONTHLY_STATISTICS**<br>(月度统计) | **管理驾驶舱**。<br>按月统计<!-- filepath: e:\@DataBase\RecipeRecommendation\viewdesign.md -->
# 第8章 视图设计方案

视图是一种虚拟表，基于一个或多个实际表的查询结果。本项目的视图主要用于简化前端查询逻辑、封装复杂关联以及提供数据报表。

**设计原则**：
1.  **只读限制**：所有视图均应定义为 `WITH READ ONLY`，仅用于数据读取，禁止通过视图进行 DML 操作。
2.  **性能优化**：视图底层查询应利用已建立的索引，避免全表扫描。

## 8.1 视图列表归纳

| 类别 | 视图名称 | 描述/用途 | 关键数据源 |
| :--- | :--- | :--- | :--- |
| **用户相关** | **USER_OVERVIEW**<br>(用户概览) | **个人资料页展示**。<br>聚合用户的基本信息、食谱数、粉丝数、关注数及平均评分。 | Users, Recipes, Followers, Ratings |
| | **ACTIVE_USERS**<br>(活跃用户) | **运营分析**。<br>筛选过去7天内有发布、评分或评论行为的用户。 | Users, Activity Logs |
| | **USER_CONTRIBUTION_SCORE**<br>(贡献评分) | **排行榜计算**。<br>基于食谱、粉丝、互动量加权计算用户的社区贡献分。 | Users, Ratings, Comments |
| **食谱相关** | **RECIPE_DETAIL**<br>(食谱详情) | **详情页展示**。<br>封装食谱基本信息、作者信息及营养成分，屏蔽已删除数据。 | Recipes, Users, Nutrition |
| | **POPULAR_RECIPES**<br>(热门食谱) | **推荐算法**。<br>基于评分(50%)、评价数(30%)、浏览量(20%)计算热度分。 | Recipes, Ratings |
| | **RECIPE_WITH_INGREDIENTS**<br>(食材清单) | **详情页展示**。<br>将食谱与食材、单位、过敏原表进行关联展平。 | Recipes, Ingredients, Units |
| | **RECIPE_WITH_STEPS**<br>(烹饪步骤) | **详情页展示**。<br>按顺序提取烹饪步骤，支持步骤导航（上一布/下一步）。 | Recipes, Cooking_Steps |
| **社交互动** | **USER_NETWORK**<br>(社交网络) | **个人中心**。<br>统计用户的社交圈数据（关注/粉丝/收藏/评论数）。 | Users, Followers, Saved_Recipes |
| | **USER_FEED**<br>(用户动态) | **首页Feed流**。<br>聚合用户关注对象的最新动态（发布、评分、评论）。 | Followers, Activity_Log |
| | **TOP_CONTRIBUTORS**<br>(顶级贡献者) | **社区发现**。<br>按综合指标排名的优质创作者列表。 | Users, Ratings |
| **健康与安全** | **INGREDIENT_HEALTH_PROFILE**<br>(食材档案) | **健康分析**。<br>展示食材的分类、过敏原信息及在食谱中的使用频率。 | Ingredients, Allergens |
| | **SAFE_RECIPES_FOR_USER**<br>(安全食谱) | **个性化推荐**。<br>自动过滤掉当前用户过敏原的食谱列表。 | Recipes, User_Allergies |
| **规划与购物** | **MEAL_PLAN_SUMMARY**<br>(计划摘要) | **膳食管理**。<br>统计膳食计划的天数、食谱数及覆盖时段。 | Meal_Plans, Meal_Plan_Entries |
| | **CONSOLIDATED_SHOPPING_LIST**<br>(购物清单) | **工具功能**。<br>合并膳食计划中所有食谱的食材，自动汇总同类食材数量。 | Meal_Plans, Ingredients |
| **分析报表** | **RECIPE_QUALITY_METRICS**<br>(质量指标) | **后台审核**。<br>多维度评估食谱质量（图片、步骤完整度、互动率）。 | Recipes, Comments, Steps |
| | **MONTHLY_STATISTICS**<br>(月度统计) | **管理驾驶舱**。<br>按月统计新增食谱、活跃用户及互动总量。 | Recipes, Ratings, Comments |
