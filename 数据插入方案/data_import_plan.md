# AllRecipes 食谱网站 - 数据录入方案（v3.0）

## 目录

1. [数据录入策略](#数据录入策略)
2. [数据量规划](#数据量规划)
3. [各表数据录入详解](#各表数据录入详解)
4. [数据录入顺序](#数据录入顺序)
5. [数据一致性检查](#数据一致性检查)
6. [测试场景设计](#测试场景设计)

---

# 数据录入策略

## 总体目标

构建一个**真实、完整、可测试的数据集**，用于验证：
- 数据库结构的完整性
- 业务逻辑的正确性
- 查询和报表的准确性
- 系统性能的表现

## 数据量设定

| 数据对象 | 数量 | 说明 |
|---------|------|------|
| 用户 | 50个 | 包括普通用户、专业厨师、美食博主 |
| 食材 | 100个 | 覆盖主要食材分类 |
| 单位 | 15个 | 常见烹饪计量单位 |
| 过敏原 | 10个 | 常见食品过敏原 |
| 标签 | 20个 | 食谱分类标签 |
| 食谱 | 200个 | 各种菜系、难度、类型 |
| 烹饪步骤 | 800个 | 平均每个食谱4-5个步骤 |
| 食材关联 | 1000个 | 平均每个食谱5个食材 |
| 评价 | 500个 | 覆盖主要食谱 |
| 评论 | 300个 | 包括一些嵌套评论 |
| 收藏 | 400个 | 用户对食谱的收藏 |
| 关注 | 150个 | 用户之间的关注关系 |

## 数据质量标准

- ✅ **完整性**：所有必填字段都有值
- ✅ **一致性**：外键关联正确，无孤立记录
- ✅ **真实性**：数据内容符合业务逻辑
- ✅ **多样性**：涵盖各种业务场景
- ✅ **可测试性**：包含典型查询场景所需的数据

---

# 数据量规划

## 详细数据规划

### 第1层：基础数据（无依赖）

#### USERS（50个用户）
- 普通用户：30个
- 专业厨师：12个
- 美食博主：8个

**分布**：
- 账户状态分布：活跃(90%)、不活跃(8%)、禁用(2%)
- 最后登录时间：过去30天

#### INGREDIENTS（100个食材）
- 蔬菜：25个（番茄、黄瓜、洋葱等）
- 肉类：20个（鸡肉、猪肉、牛肉等）
- 调味料：15个（盐、糖、酱油等）
- 乳制品：10个（牛奶、黄油、奶酪等）
- 谷物/面食：15个（米、面粉、面条等）
- 其他：15个

#### UNITS（15个单位）
- 重量单位：克(g)、千克(kg)
- 容量单位：毫升(ml)、升(L)、杯、汤匙、茶匙
- 数量单位：个(pc)、打(dozen)
- 其他：适量

#### ALLERGENS（10个过敏原）
- 花生(Peanut)
- 坚果(Tree Nuts)
- 乳制品(Dairy)
- 鸡蛋(Eggs)
- 海鲜(Shellfish)
- 鱼(Fish)
- 小麦(Wheat)
- 大豆(Soy)
- 芝麻(Sesame)
- 芥末(Mustard)

#### TAGS（20个标签）
- 饮食类型：素食、纯素、无麸质、低脂
- 烹饪方式：烤、炸、蒸、煮、炒
- 特殊场景：快手菜、节日大餐、儿童食品、健身餐
- 时间类型：早餐、午餐、晚餐、甜点、零食

### 第2层：主体数据（依赖第1层）

#### RECIPES（200个食谱）
- 中式菜：80个
- 西式菜：60个
- 日式菜：30个
- 其他菜系：30个

**难度分布**：
- 简单(easy)：60%
- 中等(medium)：30%
- 困难(hard)：10%

**发布状态**：
- 已发布：190个(95%)
- 草稿：10个(5%)

### 第3层：从属数据（依赖第2层及以上）

#### COOKING_STEPS
- 每个食谱平均4-5个步骤
- 总计：~900个步骤

#### RECIPE_INGREDIENTS
- 每个食谱平均5个食材
- 总计：~1000个关联

#### NUTRITION_INFO
- 每个发布的食谱有营养信息
- 总计：190条

#### INGREDIENT_ALLERGENS
- 每个食材可能关联1-3个过敏原
- 总计：~150个关联

#### RECIPE_TAGS
- 每个食谱平均2-3个标签
- 总计：~500个关联

### 第4层：交互数据（依赖第1层和第2层）

#### RATINGS（500条评价）
- 分数分布：
  - 5星：30%
  - 4星：40%
  - 3星：20%
  - 2星：7%
  - 1星：3%
- 每条食谱平均2-3条评价
- 20%的评价有评论文本

#### COMMENTS（300条评论）
- 嵌套结构：80%顶级，20%回复
- 每条评论50-200字
- 20%有帮助投票

#### SAVED_RECIPES（400条收藏）
- 分布在100条热门食谱上
- 每个活跃用户平均8条收藏

#### FOLLOWERS（150条关注）
- 构建社区图谱
- 专业用户被关注较多

#### USER_ALLERGIES（80条用户过敏原）
- 30%的用户有记录的过敏原
- 平均2-3个过敏原/用户

### 第5层：个人管理数据（依赖第1层和第2层）

#### RECIPE_COLLECTIONS（30个清单）
- 每个用户0-2个清单
- 平均8-10个食谱/清单

#### SHOPPING_LISTS（40个购物清单）
- 最近30天创建的
- 平均12-15个食材/清单

#### MEAL_PLANS（20个膳食计划）
- 7天或14天的计划
- 平均3-4个食谱/天

---

# 各表数据录入详解

## 1. USERS 表

**录入方式**：手工设计50个不同背景的用户

**示例用户**：

1. **超级管理员** (user_id=1)
   - 用户名：admin
   - 邮箱：admin@allrecipes.com
   - 角色：普通用户（演示用）

2. **专业厨师群体** (user_id=11-22)
   - 用户名模式：chef_master_001, chef_master_002, ...
   - 邮箱模式：chef.master.001@allrecipes.com
   - 简介：包含烹饪资历和专长

3. **美食博主群体** (user_id=23-30)
   - 用户名模式：foodblogger_001, ...
   - 简介：包含粉丝数和专注领域

4. **普通用户群体** (user_id=31-50)
   - 用户名模式：user_common_001, ...
   - 邮箱：user.common.001@allrecipes.com
   - 简介：日常用户，烹饪爱好者

**关键属性设置**：
- 密码哈希：使用模拟哈希（生产环境应使用真实加密）
- 注册日期：分散在过去12个月
- 最后登录：最近30天内
- 账户状态：95%活跃，5%非活跃
- 头像URL：设置为公开图片链接或本地路径

## 2. INGREDIENTS 表

**录入方式**：按分类有序录入

**食材分类**：

### 蔬菜类（1-25）
- 番茄、黄瓜、洋葱、大蒜、胡萝卜、土豆
- 生菜、甘蓝、菠菜、西兰花、青豆
- 辣椒、南瓜、茄子、冬瓜、苦瓜
- 冬笋、香菇、口蘑、木耳等

### 肉类（26-45）
- 鸡肉（整鸡、鸡腿、鸡翅、鸡胸）
- 猪肉（五花、瘦肉、排骨、猪肝）
- 牛肉（牛腩、牛排、梅花肉）
- 羊肉（羊腿、羊排）
- 海鲜（虾、鱼、蟹、贝类）

### 调味料（46-60）
- 盐、糖、酱油、醋、油
- 辣椒粉、咖喱粉、孜然、香叶、八角
- 酒、豆瓣酱、番茄酱

### 乳制品（61-70）
- 牛奶、黄油、奶酪、酸奶、淡奶油

### 谷物（71-85）
- 米（白米、黑米、糯米）
- 面粉、面条、馄饨皮、饺子皮
- 玉米、燕麦、豆类

### 其他（86-100）
- 鸡蛋、面包、巧克力、果酱等

## 3. UNITS 表

**录入方式**：标准烹饪单位集合

```
1. 克 (g)
2. 千克 (kg)
3. 毫升 (ml)
4. 升 (L)
5. 杯 (cup)
6. 汤匙 (tbsp) - 15ml
7. 茶匙 (tsp) - 5ml
8. 个 (pc)
9. 对 (pair)
10. 打 (dozen)
11. 斤 (catty) - 500g
12. 两 (liang) - 50g
13. 条 (stick)
14. 片 (slice)
15. 适量 (as needed)
```

## 4. ALLERGENS 表

**标准过敏原清单**：

```
1. 花生 - 常见过敏原
2. 坚果 - 可导致严重过敏
3. 乳制品 - 乳糖不耐症患者避免
4. 鸡蛋 - 常见过敏
5. 海鲜 - 甲壳类和鱼类
6. 鱼 - 具体鱼类过敏
7. 小麦 - 面筋相关
8. 大豆 - 豆制品相关
9. 芝麻 - 芝麻制品
10. 芥末 - 调味料成分
```

## 5. TAGS 表

**标签设计**：

```
# 饮食类型 (1-4)
1. 素食 - 不含肉类
2. 纯素 - 不含任何动物产品
3. 无麸质 - 不含小麦和谷物
4. 低脂 - 脂肪含量低

# 烹饪方式 (5-9)
5. 烤 - 烘烤
6. 炸 - 油炸
7. 蒸 - 清蒸
8. 煮 - 水煮/炖煮
9. 炒 - 快速炒制

# 特殊场景 (10-17)
10. 快手菜 - 30分钟以内
11. 节日大餐 - 特殊场合
12. 儿童食品 - 适合儿童
13. 健身餐 - 高蛋白低碳水
14. 减肥餐 - 低热量
15. 补气血 - 中医食疗
16. 家常菜 - 传统做法
17. 创意菜 - 创新组合

# 时间类型 (18-20)
18. 早餐 - 上午食用
19. 甜点 - 甜品糕点
20. 零食 - 小食品
```

## 6. RECIPES 表

**录入方式**：按菜系生成不同难度的食谱

**中式菜示例** (recipes 1-80)：
- 早餐类：煎饼、馄饨汤、豆浆油条等
- 午餐/晚餐：红烧肉、水煮鱼、宫保鸡丁、麻婆豆腐等
- 特色菜：北京烤鸭、四川麻辣、广东点心等
- 汤类：排骨汤、鸡汤、冬瓜汤等

**西式菜示例** (recipes 81-140)：
- 意大利面：意大利肉酱面、奶油面等
- 沙拉：凯撒沙拉、希腊沙拉等
- 主菜：牛排、烤鸡、炉灶烤肉等
- 甜点：提拉米苏、巧克力蛋糕等

**日式菜示例** (recipes 141-170)：
- 寿司：卷寿司、握寿司等
- 面类：拉面、乌冬面等
- 其他：天妇罗、烤肉等

**其他菜系** (recipes 171-200)：
- 泰式、印度、韩式等

**属性设置**：
- 烹饪时间：5-120分钟不等
- 难度等级：按比例分配
- 份数：2-6人不等
- 热量值：200-1500千卡
- 发布状态：95%已发布

## 7. COOKING_STEPS 表

**录入方式**：为每个食谱添加4-5个步骤

**示例步骤** (以红烧肉为例)：
```
步骤1：选择五花肉，切成2cm见方的块状，约700克
步骤2：锅中加油烧热，放入冰糖炒至焦黄色，加入肉块炒至变色
步骤3：加入酱油、老抽、葱段、姜片、八角、香叶等调料
步骤4：加入热水没过肉块，大火烧开后转小火炖60分钟
步骤5：炖至肉块软烂，汤汁浓稠，撒上葱段即可出锅
```

## 8. NUTRITION_INFO 表

**录入方式**：为每个发布的食谱添加营养信息

**典型营养指标** (以红烧肉为例，每人份)：
```
卡路里：480卡
蛋白质：28克
碳水化合物：15克
脂肪：32克
纤维：2克
糖：8克
钠：800毫克
```

## 9. INGREDIENT_ALLERGENS 表

**录入方式**：关联食材与其包含的过敏原

**示例关联**：
```
花生油 → 花生过敏原
牛奶 → 乳制品过敏原
鸡蛋 → 鸡蛋过敏原
虾 → 海鲜过敏原
小麦粉 → 小麦过敏原
```

## 10. RECIPE_INGREDIENTS 表

**录入方式**：为每个食谱添加所需食材

**示例** (红烧肉配方)：
```
食谱ID=1, 五花肉, 700克
食谱ID=1, 冰糖, 50克
食谱ID=1, 酱油, 100毫升
食谱ID=1, 老抽, 50毫升
食谱ID=1, 油, 3汤匙
食谱ID=1, 葱, 2条
食谱ID=1, 姜, 3片
食谱ID=1, 八角, 2个
食谱ID=1, 香叶, 3片
```

## 11. INGREDIENT_SUBSTITUTIONS 表

**录入方式**：添加常见食材替代品

**示例替代关系**：
```
牛油 → 植物油，比例1:1.2
淡奶油 → 酸奶，比例1:1.5
鸡蛋 → 亚麻籽粉+水，比例1:3
全麦粉 → 普通面粉，比例1:1
蜂蜜 → 糖，比例1:0.8
```

## 12. RECIPE_TAGS 表

**录入方式**：为每个食谱添加2-3个标签

**示例标签关联**：
```
红烧肉 → 家常菜, 补气血, 中等难度
番茄鸡蛋面 → 快手菜, 早餐, 简单
健身鸡胸肉 → 健身餐, 低脂, 简单
素食沙拉 → 素食, 低脂, 简单
```

## 13. RATINGS 表

**录入方式**：为热门食谱添加评价

**评价分布**：
```
5星(优秀): 30% - "非常好吃！"
4星(良好): 40% - "不错，再改进一下..."
3星(一般): 20% - "还可以，但有点..."
2星(较差): 7% - "不太满意"
1星(很差): 3% - "不推荐"
```

## 14. COMMENTS 表

**录入方式**：为部分评价添加评论文本

**评论类型**：
- 实用建议："这道菜配XX会更好吃"
- 经验分享："我的做法是这样的..."
- 疑问提问："用高压锅行吗？"
- 问题反馈："按照步骤但还是失败了"

## 15. SAVED_RECIPES 表

**录入方式**：模拟用户收藏行为

**收藏分布**：
- 热门食谱被收藏较多（5-15次）
- 普通食谱被收藏较少（0-3次）
- 新食谱基本没有收藏

## 16. FOLLOWERS 表

**录入方式**：构建用户社交网络

**关注规律**：
- 专业厨师被普通用户广泛关注
- 美食博主粉丝众多
- 普通用户之间也有相互关注

## 17. USER_ALLERGIES 表

**录入方式**：设置部分用户的过敏原记录

**示例**：
```
用户ID=5 → 花生过敏
用户ID=8 → 乳制品过敏
用户ID=12 → 海鲜过敏
用户ID=15 → 花生+坚果过敏
```

---

# 数据录入顺序

## 严格的依赖顺序

**第1阶段：基础参考数据** (无依赖)
1. ✅ USERS - 50个用户
2. ✅ INGREDIENTS - 100个食材
3. ✅ UNITS - 15个单位
4. ✅ ALLERGENS - 10个过敏原
5. ✅ TAGS - 20个标签

**第2阶段：主体数据** (依赖第1阶段)
6. ✅ RECIPES - 200个食谱
7. ✅ INGREDIENT_ALLERGENS - 食材-过敏原关系
8. ✅ INGREDIENT_SUBSTITUTIONS - 食材替代品关系

**第3阶段：食谱详情** (依赖第2阶段)
9. ✅ COOKING_STEPS - 食谱步骤
10. ✅ RECIPE_INGREDIENTS - 食谱食材关系
11. ✅ NUTRITION_INFO - 食谱营养信息
12. ✅ RECIPE_TAGS - 食谱标签关系

**第4阶段：用户交互** (依赖第1阶段和第3阶段)
13. ✅ RATINGS - 食谱评价
14. ✅ COMMENTS - 评论
15. ✅ SAVED_RECIPES - 收藏
16. ✅ FOLLOWERS - 关注
17. ✅ USER_ALLERGIES - 用户过敏原
18. ✅ RATING_HELPFULNESS - 评价有用性投票
19. ✅ COMMENT_HELPFULNESS - 评论有用性投票

**第5阶段：个人管理** (依赖第1阶段和第3阶段)
20. ✅ RECIPE_COLLECTIONS - 食谱清单
21. ✅ COLLECTION_RECIPES - 清单食谱关系
22. ✅ SHOPPING_LISTS - 购物清单
23. ✅ SHOPPING_LIST_ITEMS - 购物清单项目
24. ✅ MEAL_PLANS - 膳食计划
25. ✅ MEAL_PLAN_ENTRIES - 膳食计划条目

---

# 数据一致性检查

## 检查清单

**1. 主键检查**
- [ ] 所有主键字段非空
- [ ] 所有主键值唯一
- [ ] 序列号连续无跳转

**2. 外键检查**
- [ ] 所有外键指向有效的主键
- [ ] 没有孤立记录（外键值指向不存在的主键）

**3. 值范围检查**
- [ ] 评分值在0-5之间
- [ ] 时间字段在合理范围
- [ ] 数量字段为正数

**4. 参照完整性**
- [ ] 食谱-食材关联完整
- [ ] 用户-评价关联完整
- [ ] 评论嵌套关系正确

**5. 数据一致性**
- [ ] 食谱的总时间 = 准备时间 + 烹饪时间
- [ ] 用户粉丝数与FOLLOWERS表一致
- [ ] 食谱评分与RATINGS表平均值一致

---

# 测试场景设计

## 业务场景验证

### 场景1：用户浏览和评价食谱
```
✓ 用户1浏览了食谱ID=1
✓ 用户1给食谱ID=1评价5星
✓ 用户2给食谱ID=1评价4星
✓ 查询食谱ID=1的平均评分应为4.5
```

### 场景2：用户过敏原检查
```
✓ 用户5有花生过敏
✓ 食谱ID=10包含花生油
✓ 推荐系统应标记食谱ID=10为"不安全"
```

### 场景3：食材替代品
```
✓ 用户想做红烧肉但没有牛油
✓ 系统推荐用植物油替代
✓ 用量调整为1.2倍
```

### 场景4：膳食计划
```
✓ 用户1创建膳食计划（7天）
✓ 为每天安排3个食谱（早午晚）
✓ 系统自动生成购物清单
✓ 购物清单中所有食材合并计算
```

### 场景5：社交功能
```
✓ 用户2关注用户1
✓ 用户1发布新食谱
✓ 用户2的信息流中显示此食谱
```

### 场景6：内容管理
```
✓ 专业厨师1发布食谱
✓ 普通用户大量收藏
✓ 食谱排名提升
```

---

## 推荐的SQL测试查询

### 1. 查询平均评分最高的10个食谱
```sql
SELECT TOP 10 recipe_id, recipe_name, average_rating, rating_count
FROM RECIPES
WHERE is_published = 'Y'
ORDER BY average_rating DESC, rating_count DESC;
```

### 2. 查询用户及其粉丝数
```sql
SELECT u.user_id, u.username, COUNT(f.follower_user_id) as followers
FROM USERS u
LEFT JOIN FOLLOWERS f ON u.user_id = f.user_id
GROUP BY u.user_id, u.username
ORDER BY followers DESC;
```

### 3. 查询每个用户的过敏原
```sql
SELECT u.user_id, u.username, 
       LISTAGG(a.allergen_name, ', ') WITHIN GROUP (ORDER BY a.allergen_name) as allergies
FROM USERS u
LEFT JOIN USER_ALLERGIES ua ON u.user_id = ua.user_id
LEFT JOIN ALLERGENS a ON ua.allergen_id = a.allergen_id
GROUP BY u.user_id, u.username;
```

### 4. 查询某个用户的安全食谱
```sql
SELECT DISTINCT r.recipe_id, r.recipe_name
FROM RECIPES r
WHERE r.is_published = 'Y'
  AND r.recipe_id NOT IN (
      SELECT DISTINCT ri.recipe_id
      FROM RECIPE_INGREDIENTS ri
      JOIN INGREDIENT_ALLERGENS ia ON ri.ingredient_id = ia.ingredient_id
      JOIN USER_ALLERGIES ua ON ia.allergen_id = ua.allergen_id
      WHERE ua.user_id = ? -- 替换为实际用户ID
  )
ORDER BY r.average_rating DESC;
```

---

**数据录入总用时**：约1-2小时（通过SQL脚本自动化）  
**数据验证用时**：约30分钟  
**总体建议**：建议先导入基础数据，验证无误后再导入交互数据
